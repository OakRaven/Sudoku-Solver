// Generated by CoffeeScript 1.3.3
(function(){var e;e={UP:38,DOWN:40,LEFT:37,RIGHT:39},this.PuzzleUi=function(){function t(){this.currentlySelectedRow=null,this.currentlySelectedCol=null,this.currentlySelectedCell=null,this.samplePuzzle=[[0,0,0,0,0,0,7,4,0],[0,0,1,0,0,5,3,0,2],[0,3,4,7,0,0,0,5,6],[0,0,7,0,2,0,0,6,0],[0,0,0,9,0,3,0,0,0],[0,1,0,0,4,0,2,0,0],[5,4,0,0,0,7,9,2,0],[1,0,6,3,0,0,5,0,0],[0,7,8,0,0,0,0,0,0]],this.emptyPuzzle=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]}return t.prototype.buildTable=function(){var e,t,n,r,i;n="";for(t=r=1;r<=9;t=++r){n+="<tr>";for(e=i=1;i<=9;e=++i)n+='<td data-row="'+t+'" data-col="'+e+'"><input type="text" maxlength="1" value=""><span></span></td>';n+="</tr>"}return $("#grid table").append(n)},t.prototype.highlight=function(e){var t,n;return this.unhighlight(),n=$(e).data("row"),t=$(e).data("col"),$("#grid tr:nth-child("+n+") td").addClass("highlight"),$("#grid tr td:nth-child("+t+")").addClass("highlight"),this.currentlySelectedRow=n,this.currentlySelectedCol=t},t.prototype.hideEdit=function(e){var t,n;return t=$(e),n=t.find("input").val(),t.find("span").text(n),$(this.currentlySelectedCell).removeClass("selected-cell")},t.prototype.displayEdit=function(e){return this.currentlySelectedCell&&this.hideEdit(this.currentlySelectedCell),$(e).addClass("selected-cell"),$(e).find("input").select(),this.currentlySelectedCell=e},t.prototype.unhighlight=function(){return this.currentlySelectedCell&&this.hideEdit(this.currentlySelectedCell),$("#grid tr td").removeClass("highlight")},t.prototype.extractGridValues=function(){var e;return e=[],$.each($("#grid tr"),function(t,n){var r;return r=[],$.each($(n).find("td"),function(e,t){var n;return n=$(t).find("span"),r.push(parseInt(n.text().trim())||0)}),e.push(r)}),e},t.prototype.set=function(e,t,n,r){var i,s,o,u;r==null&&(r=null),o=$("#grid tr:nth-child("+(e+1)+")"),i=$(o).find("td:nth-child("+(t+1)+")"),u=$(i).find("span"),s=$(i).find("input");if(u.text()===""){r&&u.addClass(r),u.text(n),s.val(n);if(r)return i.effect("highlight",{},1500)}},t.prototype.clear_board=function(){return $("#grid td input").val(""),$("#grid td span").text(""),$("#grid td span").removeClass("solved")},t.prototype.pushSolution=function(e){var t,n,r,i,s,o,u,a,f,l,c;$("#grid td span").removeClass("solved"),s=0,c=[];for(u=0,f=e.length;u<f;u++){i=e[u],n=0;for(a=0,l=i.length;a<l;a++)t=i[a],o=e[s][n],r="solved",o&&this.set(s,n,o,r),n+=1;c.push(s+=1)}return c},t.prototype.presetBoard=function(e){var t,n,r,i,s,o,u,a,f,l;this.clear_board(),i=0,l=[];for(o=0,a=e.length;o<a;o++){r=e[o],n=0;for(u=0,f=r.length;u<f;u++)t=r[u],s=e[i][n],s&&this.set(i,n,s),n+=1;l.push(i+=1)}return l},t.prototype.move_selection=function(t){var n,r,i;if(this.currentlySelectedCell)return i=$(this.currentlySelectedCell).data("row"),r=$(this.currentlySelectedCell).data("col"),t===e.DOWN&&(i+=1,i>9&&(i=1)),t===e.UP&&(i-=1,i<1&&(i=9)),t===e.RIGHT&&(r+=1,r>9&&(r=1)),t===e.LEFT&&(r-=1,r<1&&(r=9)),n=$("#grid tr:nth-child("+i+")").find("td:nth-child("+r+")"),this.highlight(n),this.displayEdit(n)},t.prototype.hide_alert=function(){return $("#alert-panel").hide()},t.prototype.show_alert=function(){return $("#alert-panel").show()},t.prototype.initializeBoard=function(){var t=this;return this.buildTable(),$("#alert-panel .close").on("click",function(){return t.hide_alert()}),$("#grid").on("mouseenter","td",function(e){return t.highlight($(e.currentTarget))}),$("#grid").on("click","td",function(e){return t.displayEdit($(e.currentTarget))}),$("#grid").on("mouseleave","table",function(e){return t.unhighlight()}),$("#grid").on("keypress","input",function(e){var t;t=String.fromCharCode(e.keyCode);if($.inArray(t,["1","2","3","4","5","6","7","8","9"])===-1)return e.preventDefault()}),$("#solve-btn").on("click",function(e){var n,r,i;return e.preventDefault(),n=t.extractGridValues(),i=new SudokuSolver(n),i.is_valid_puzzle()?(r=i.solve(),t.pushSolution(r)):t.show_alert()}),$("#sample-btn").on("click",function(e){return e.preventDefault(),t.presetBoard(t.samplePuzzle)}),$("#clear-btn").on("click",function(e){return e.preventDefault(),t.presetBoard(t.emptyPuzzle)}),$("#hint-btn").on("click",function(e){var n,r,i;e.preventDefault(),n=t.extractGridValues(),i=new SudokuSolver(n);if(!i.is_valid_puzzle())return t.show_alert();r=i.get_hint();if(r)return t.set(r.row,r.column,r.value,"solved")}),$("#grid").on("keydown","input",function(n){var r;r=n.keyCode;if(r===e.UP||r===e.DOWN||r===e.LEFT||r===e.RIGHT)return n.preventDefault(),t.move_selection(r)})},t}(),this.SudokuSolver=function(){function e(e){this.puzzle=e,this.size=this.puzzle.length,this.squareSize=Math.sqrt(this.puzzle.length),this.hints=[]}return e.prototype.solve_cell=function(e,t){var n,r,i;if(t>=this.size)return!0;if(e>=this.size)return this.solve_cell(0,t+1);if(this.puzzle[e][t]!==0)return this.solve_cell(e+1,t);for(n=r=1,i=this.size;1<=i?r<=i:r>=i;n=1<=i?++r:--r)if(this.valid(e,t,n)){this.set(e,t,n);if(this.solve_cell(e+1,t))return!0}return this.set(e,t,0),!1},e.prototype.solve=function(){return this.attempts=0,this.hints=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],this.solve_cell(0,0),this.puzzle},e.prototype.get_hint=function(){var e,t,n,r,i,s,o,u;this.solve(),t=[];for(r=i=0,o=this.size-1;0<=o?i<=o:i>=o;r=0<=o?++i:--i)for(e=s=0,u=this.size-1;0<=u?s<=u:s>=u;e=0<=u?++s:--s)this.hints[r][e]!==0&&t.push({row:r,column:e,value:this.hints[r][e]});return t.length>0?(n=Math.floor(Math.random()*t.length+1),t[n]):null},e.prototype.set=function(e,t,n){return this.puzzle[e][t]=n,this.hints[e][t]=n},e.prototype.get=function(e,t){return this.puzzle[e][t]},e.prototype.is_valid_puzzle=function(){var e,t,n,r,i,s,o;for(t=r=0,s=this.size-1;0<=s?r<=s:r>=s;t=0<=s?++r:--r)for(e=i=0,o=this.size-1;0<=o?i<=o:i>=o;e=0<=o?++i:--i){n=this.puzzle[t][e];if(n>0&&!this.valid(t,e,n))return!1}return!0},e.prototype.valid=function(e,t,n){var r;return r=this.valid_in_row(e,t,n)&&this.valid_in_col(e,t,n)&&this.valid_in_square(e,t,n),r},e.prototype.valid_in_row=function(e,t,n){var r,i,s;for(r=i=0,s=this.size-1;0<=s?i<=s:i>=s;r=0<=s?++i:--i)if(r!==t&&this.get(e,r)===n)return!1;return!0},e.prototype.valid_in_col=function(e,t,n){var r,i,s;for(r=i=0,s=this.size-1;0<=s?i<=s:i>=s;r=0<=s?++i:--i)if(r!==e&&this.get(r,t)===n)return!1;return!0},e.prototype.valid_in_square=function(e,t,n){var r,i,s,o,u,a,f,l;o=Math.floor(e/this.squareSize)*this.squareSize,i=Math.floor(t/this.squareSize)*this.squareSize;for(s=u=0,f=this.squareSize-1;0<=f?u<=f:u>=f;s=0<=f?++u:--u)for(r=a=0,l=this.squareSize-1;0<=l?a<=l:a>=l;r=0<=l?++a:--a)if(o+s!==e&&i+r!==t&&this.get(o+s,i+r)===n)return!1;return!0},e}()}).call(this);